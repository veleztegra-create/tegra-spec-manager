<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Generación de PDF - Tegra Spec Manager</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
    .success { color: green; }
    .error { color: red; }
    .warning { color: orange; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    .log { background: #1a1a1a; color: #0f0; padding: 10px; font-family: monospace; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Test de Generación de PDF</h1>
  
  <div class="test-section">
    <h2>Verificación de Librerías</h2>
    <div id="lib-check"></div>
  </div>
  
  <div class="test-section">
    <h2>Test de Generación</h2>
    <button onclick="testBasicPDF()">Generar PDF Básico</button>
    <button onclick="testHTML2Canvas()">Test html2canvas</button>
    <div id="test-result"></div>
  </div>
  
  <div class="test-section">
    <h2>Log de Eventos</h2>
    <div id="log" class="log"></div>
    <button onclick="clearLog()">Limpiar Log</button>
  </div>

  <script>
    function log(msg, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#ff0';
      logDiv.innerHTML += `<div style="color:${color}">[${time}] ${msg}</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${time}] ${msg}`);
    }
    
    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }
    
    // Verificar librerías
    function checkLibraries() {
      const div = document.getElementById('lib-check');
      let html = '';
      
      if (typeof window.jspdf !== 'undefined') {
        html += '<p class="success">✅ jsPDF cargado correctamente</p>';
        log('jsPDF cargado', 'success');
      } else {
        html += '<p class="error">❌ jsPDF NO está cargado</p>';
        log('jsPDF NO cargado', 'error');
      }
      
      if (typeof window.html2canvas !== 'undefined') {
        html += '<p class="success">✅ html2canvas cargado correctamente</p>';
        log('html2canvas cargado', 'success');
      } else {
        html += '<p class="error">❌ html2canvas NO está cargado</p>';
        log('html2canvas NO cargado', 'error');
      }
      
      div.innerHTML = html;
    }
    
    // Test PDF básico
    function testBasicPDF() {
      log('Iniciando test de PDF básico...');
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        pdf.text('Test de PDF exitoso!', 10, 10);
        pdf.save('test-basic.pdf');
        log('PDF básico generado correctamente', 'success');
        document.getElementById('test-result').innerHTML = '<p class="success">PDF generado! Revisa tu carpeta de descargas.</p>';
      } catch (e) {
        log('Error: ' + e.message, 'error');
        document.getElementById('test-result').innerHTML = '<p class="error">Error: ' + e.message + '</p>';
      }
    }
    
    // Test html2canvas
    async function testHTML2Canvas() {
      log('Iniciando test de html2canvas...');
      try {
        const testDiv = document.createElement('div');
        testDiv.innerHTML = '<h1 style="color:red;">Test HTML</h1><p>Esto es una prueba</p>';
        testDiv.style.padding = '20px';
        testDiv.style.background = 'white';
        document.body.appendChild(testDiv);
        
        const canvas = await html2canvas(testDiv);
        document.body.removeChild(testDiv);
        
        log('html2canvas funcionó correctamente', 'success');
        document.getElementById('test-result').innerHTML = '<p class="success">html2canvas funcionó! Canvas: ' + canvas.width + 'x' + canvas.height + '</p>';
      } catch (e) {
        log('Error en html2canvas: ' + e.message, 'error');
        document.getElementById('test-result').innerHTML = '<p class="error">Error: ' + e.message + '</p>';
      }
    }
    
    // Verificar al cargar
    window.onload = checkLibraries;
  </script>
</body>
</html>
