<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Especificaciones Técnicas - Tegra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --tegra-primary: #1a3c8b;
            --tegra-secondary: #00a3e0;
            --tegra-success: #28a745;
            --tegra-light: #f8f9fa;
            --tegra-dark: #343a40;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            padding-top: 20px;
        }
        
        .tegra-header {
            background: linear-gradient(135deg, var(--tegra-primary) 0%, #0d2b6b 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn-tegra {
            background-color: var(--tegra-secondary);
            border-color: var(--tegra-secondary);
            color: white;
        }
        
        .btn-tegra:hover {
            background-color: #0088c0;
            border-color: #0088c0;
            color: white;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
            margin-bottom: 1.5rem;
            border-radius: 10px;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .spec-card {
            border-left: 4px solid var(--tegra-primary);
        }
        
        .modal-content {
            border-radius: 10px;
        }
        
        .filter-btn {
            margin: 0.2rem;
        }
        
        .badge-category {
            font-size: 0.8rem;
            padding: 0.4rem 0.8rem;
        }
        
        footer {
            margin-top: 3rem;
            padding: 1.5rem;
            background-color: var(--tegra-dark);
            color: white;
            border-radius: 10px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-container i {
            position: absolute;
            left: 15px;
            top: 12px;
            color: #6c757d;
        }
        
        .search-container input {
            padding-left: 40px;
        }
        
        /* Estilos para notificaciones */
        .tegra-notification {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            z-index: 9999 !important;
            min-width: 300px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            animation: slideIn 0.3s ease-out !important;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Mejoras para campos de especificaciones */
        .spec-field-group {
            transition: all 0.2s ease;
        }
        
        .spec-field-group:focus-within {
            border-color: var(--tegra-secondary);
            box-shadow: 0 0 0 0.2rem rgba(0, 163, 224, 0.25);
        }
        
        /* Estilo para botones activos */
        .filter-btn.active {
            background-color: var(--tegra-primary) !important;
            color: white !important;
            border-color: var(--tegra-primary) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="tegra-header text-center">
            <h1><i class="fas fa-microchip me-2"></i>Gestor de Especificaciones Técnicas</h1>
            <p class="lead mb-0">Sistema de gestión y consulta de especificaciones técnicas de productos Tegra</p>
        </header>

        <!-- Controles -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" id="searchInput" placeholder="Buscar especificaciones por nombre, categoría o característica...">
                </div>
            </div>
            <div class="col-md-4">
                <button class="btn btn-tegra w-100" data-bs-toggle="modal" data-bs-target="#addSpecModal">
                    <i class="fas fa-plus me-2"></i>Agregar Especificación
                </button>
            </div>
        </div>

        <!-- Filtros -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-filter me-2"></i>Filtros</h5>
                        <div id="categoryFilters">
                            <!-- Las categorías se generarán dinámicamente -->
                            <button class="btn btn-outline-primary btn-sm filter-btn active" data-category="all">
                                Todas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contador -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-light d-flex justify-content-between align-items-center">
                    <span id="specCount">Cargando especificaciones...</span>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-2" id="exportBtn">
                            <i class="fas fa-download me-1"></i>Exportar
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="refreshBtn">
                            <i class="fas fa-sync-alt me-1"></i>Actualizar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Especificaciones -->
        <div class="row" id="specsContainer">
            <!-- Las especificaciones se cargarán aquí dinámicamente -->
            <div class="loading" id="loadingIndicator">
                <div class="spinner-border text-tegra-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <p class="mt-2">Cargando especificaciones...</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center">
            <p class="mb-0">© 2024 Tegra - Gestor de Especificaciones Técnicas</p>
            <p class="mb-0 text-muted">Versión 1.0.0 | Todos los derechos reservados</p>
        </footer>
    </div>

    <!-- Modal para Agregar/Editar -->
    <div class="modal fade" id="addSpecModal" tabindex="-1" aria-labelledby="addSpecModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSpecModalLabel">Agregar Nueva Especificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="specForm">
                        <input type="hidden" id="specId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="specName" class="form-label">Nombre del Producto *</label>
                                <input type="text" class="form-control" id="specName" required>
                                <div class="form-text">Ej: Servidor Tegra X100, Firewall Tegra Secure</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="specCategory" class="form-label">Categoría *</label>
                                <select class="form-select" id="specCategory" required>
                                    <option value="">Seleccionar categoría...</option>
                                    <option value="Hardware">Hardware</option>
                                    <option value="Software">Software</option>
                                    <option value="Periféricos">Periféricos</option>
                                    <option value="Redes">Redes</option>
                                    <option value="Seguridad">Seguridad</option>
                                    <option value="Otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="specDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="specDescription" rows="3" placeholder="Describa el producto y sus características principales..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="specVersion" class="form-label">Versión</label>
                                <input type="text" class="form-control" id="specVersion" placeholder="Ej: 1.0.0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="specStatus" class="form-label">Estado</label>
                                <select class="form-select" id="specStatus">
                                    <option value="Activo">Activo</option>
                                    <option value="En desarrollo">En desarrollo</option>
                                    <option value="Beta">Beta</option>
                                    <option value="Descontinuado">Descontinuado</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="specDate" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="specDate" value="">
                                <div class="form-text">Fecha de creación o actualización</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Especificaciones Técnicas *</label>
                            <div class="alert alert-light py-2 mb-3">
                                <small><i class="fas fa-info-circle me-1"></i>Agregue al menos una especificación técnica con su valor correspondiente</small>
                            </div>
                            <div id="techSpecsContainer">
                                <!-- Los campos se agregarán dinámicamente -->
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-tegra mt-2" id="addSpecField">
                                <i class="fas fa-plus me-1"></i>Agregar Campo
                            </button>
                            <div class="form-text">Ej: Procesador → Intel Xeon, RAM → 128GB, Almacenamiento → 4TB SSD</div>
                        </div>
                        <div class="alert alert-warning py-2 mt-3">
                            <small><i class="fas fa-exclamation-triangle me-1"></i>Los campos marcados con * son obligatorios</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-tegra" id="saveSpecBtn">Guardar Especificación</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ============================================
        // CONFIGURACIÓN Y DATOS INICIALES
        // ============================================
        
        // Base de datos simulada (con persistencia en localStorage)
        let specifications = [];
        let currentFilter = 'all';
        let editMode = false;
        let nextId = 1;

        // ============================================
        // SISTEMA DE PERSISTENCIA (LOCALSTORAGE)
        // ============================================
        
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('tegra-specifications');
                const savedNextId = localStorage.getItem('tegra-nextId');
                
                if (saved) {
                    specifications = JSON.parse(saved);
                    console.log(`Datos cargados: ${specifications.length} especificaciones`);
                }
                
                if (savedNextId) {
                    nextId = parseInt(savedNextId);
                } else if (specifications.length > 0) {
                    // Calcular el siguiente ID basado en los datos existentes
                    nextId = Math.max(...specifications.map(s => s.id)) + 1;
                }
                
                // Si no hay datos, cargar ejemplos por defecto
                if (specifications.length === 0) {
                    loadDefaultSpecifications();
                }
            } catch (e) {
                console.error('Error cargando datos:', e);
                loadDefaultSpecifications();
            }
        }
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('tegra-specifications', JSON.stringify(specifications));
                localStorage.setItem('tegra-nextId', nextId.toString());
            } catch (e) {
                console.error('Error guardando datos:', e);
                showNotification('Error al guardar datos localmente', 'error');
            }
        }
        
        function loadDefaultSpecifications() {
            specifications = [
                {
                    id: 1,
                    name: "Servidor Tegra X100",
                    category: "Hardware",
                    description: "Servidor empresarial de alto rendimiento",
                    version: "2.1",
                    status: "Activo",
                    date: "2024-01-15",
                    specs: {
                        "Procesador": "Intel Xeon Gold 6314U",
                        "RAM": "128 GB DDR4",
                        "Almacenamiento": "4 TB NVMe SSD",
                        "Red": "Dual 10Gb Ethernet",
                        "Garantía": "3 años"
                    }
                },
                {
                    id: 2,
                    name: "Firewall Tegra Secure",
                    category: "Seguridad",
                    description: "Firewall de última generación con protección avanzada",
                    version: "3.0",
                    status: "Activo",
                    date: "2024-02-10",
                    specs: {
                        "Throughput": "10 Gbps",
                        "Conexiones simultáneas": "1,000,000",
                        "VPNs soportadas": "IPSec, SSL, OpenVPN",
                        "Licencias incluidas": "3 años",
                        "Interfaces": "8 x 1GbE, 2 x 10GbE SFP+"
                    }
                },
                {
                    id: 3,
                    name: "Switch Tegra Net24",
                    category: "Redes",
                    description: "Switch gestionable 24 puertos Gigabit",
                    version: "1.5",
                    status: "Activo",
                    date: "2024-01-30",
                    specs: {
                        "Puertos": "24 x 1GbE + 2 x SFP",
                        "Velocidad de backplane": "56 Gbps",
                        "VLANs": "Hasta 256",
                        "PoE": "Sí (8 puertos)",
                        "Nivel de conmutación": "L2/L3"
                    }
                }
            ];
            nextId = 4;
            saveToLocalStorage();
        }

        // ============================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            // Cargar datos
            loadFromLocalStorage();
            
            // Inicializar interfaz
            renderSpecifications();
            setupCategoryFilters();
            setupEventListeners();
            resetSpecFields(); // Inicializar campos de especificaciones
            
            // Mostrar estado inicial
            updateSpecCount();
            showNotification('Aplicación cargada correctamente', 'success');
        }
        
        function setupEventListeners() {
            // Buscador
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    handleSearch(this.value);
                }, 300);
            });
            
            // Botones principales
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('saveSpecBtn').addEventListener('click', saveSpecification);
            document.getElementById('addSpecField').addEventListener('click', addSpecField);
            
            // Configurar modal
            const modal = document.getElementById('addSpecModal');
            modal.addEventListener('shown.bs.modal', function() {
                document.getElementById('specName').focus();
            });
            
            modal.addEventListener('hidden.bs.modal', function() {
                resetForm();
                editMode = false;
                document.getElementById('addSpecModalLabel').textContent = 'Agregar Nueva Especificación';
            });
            
            // Configurar filtros
            setupFilterListeners();
        }
        
        function setupFilterListeners() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                // Usar event delegation para evitar duplicados
                btn.addEventListener('click', function() {
                    currentFilter = this.getAttribute('data-category');
                    
                    // Actualizar estado visual
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Aplicar filtro
                    renderSpecifications();
                });
            });
        }

        // ============================================
        // RENDERIZADO DE ESPECIFICACIONES
        // ============================================
        
        function renderSpecifications() {
            const container = document.getElementById('specsContainer');
            const loading = document.getElementById('loadingIndicator');
            
            // Mostrar loading
            loading.style.display = 'block';
            container.innerHTML = '';
            container.appendChild(loading);
            
            // Filtrar especificaciones
            let filteredSpecs = currentFilter === 'all' 
                ? specifications 
                : specifications.filter(spec => spec.category === currentFilter);
            
            // Simular delay de carga
            setTimeout(() => {
                loading.style.display = 'none';
                
                if (filteredSpecs.length === 0) {
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-info-circle me-2"></i>
                                No se encontraron especificaciones con los filtros aplicados.
                                ${currentFilter !== 'all' ? '<br><small>Intente cambiar el filtro o agregar nuevas especificaciones.</small>' : ''}
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Renderizar cada especificación
                filteredSpecs.forEach(spec => {
                    const specCard = createSpecCard(spec);
                    container.appendChild(specCard);
                });
                
                // Actualizar contador
                updateSpecCount(filteredSpecs.length);
            }, 200);
        }
        
        function createSpecCard(spec) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';
            
            // Generar HTML de especificaciones técnicas
            let specsHTML = '';
            for (const [key, value] of Object.entries(spec.specs)) {
                specsHTML += `
                    <div class="row mb-1">
                        <div class="col-6 text-muted"><small>${key}:</small></div>
                        <div class="col-6 fw-semibold"><small>${value}</small></div>
                    </div>
                `;
            }
            
            col.innerHTML = `
                <div class="card spec-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title mb-0">${escapeHtml(spec.name)}</h5>
                            <span class="badge bg-${getStatusColor(spec.status)}">${spec.status}</span>
                        </div>
                        
                        <div class="mb-3">
                            <span class="badge bg-primary badge-category">${spec.category}</span>
                            ${spec.version ? `<span class="badge bg-secondary badge-category">v${spec.version}</span>` : ''}
                            ${spec.date ? `<span class="badge bg-light text-dark badge-category">${formatDate(spec.date)}</span>` : ''}
                        </div>
                        
                        <p class="card-text text-muted small">${spec.description || 'Sin descripción'}</p>
                        
                        <div class="tech-specs mt-3">
                            ${specsHTML}
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top-0 pt-0">
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${spec.id}">
                                <i class="fas fa-edit me-1"></i>Editar
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${spec.id}">
                                <i class="fas fa-trash me-1"></i>Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Agregar event listeners
            const editBtn = col.querySelector('.edit-btn');
            const deleteBtn = col.querySelector('.delete-btn');
            
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                editSpecification(spec.id);
            });
            
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteSpecification(spec.id);
            });
            
            return col;
        }
        
        function setupCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            
            // Obtener categorías únicas
            const categories = ['all', ...new Set(specifications.map(spec => spec.category))];
            
            // Limpiar contenedor (excepto el botón "Todas")
            const allBtn = container.querySelector('[data-category="all"]');
            container.innerHTML = '';
            container.appendChild(allBtn);
            
            // Agregar botones de categoría
            categories.filter(cat => cat !== 'all').forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-outline-primary btn-sm filter-btn';
                btn.setAttribute('data-category', category);
                btn.textContent = category;
                container.appendChild(btn);
            });
            
            // Reconfigurar listeners
            setupFilterListeners();
        }

        // ============================================
        // BÚSQUEDA Y FILTRADO
        // ============================================
        
        function handleSearch(searchTerm) {
            if (!searchTerm || searchTerm.trim() === '') {
                renderSpecifications();
                return;
            }
            
            const term = searchTerm.toLowerCase().trim();
            const filteredSpecs = specifications.filter(spec => 
                spec.name.toLowerCase().includes(term) ||
                spec.category.toLowerCase().includes(term) ||
                spec.description.toLowerCase().includes(term) ||
                Object.entries(spec.specs).some(([key, value]) => 
                    key.toLowerCase().includes(term) || 
                    value.toString().toLowerCase().includes(term)
                )
            );
            
            const container = document.getElementById('specsContainer');
            
            container.innerHTML = '';
            
            if (filteredSpecs.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-warning text-center">
                            <i class="fas fa-search me-2"></i>
                            No se encontraron resultados para "${escapeHtml(searchTerm)}".
                        </div>
                    </div>
                `;
                updateSpecCount(0, searchTerm);
                return;
            }
            
            filteredSpecs.forEach(spec => {
                const specCard = createSpecCard(spec);
                container.appendChild(specCard);
            });
            
            updateSpecCount(filteredSpecs.length, searchTerm);
        }

        // ============================================
        // GESTIÓN DE ESPECIFICACIONES (CRUD)
        // ============================================
        
        function editSpecification(id) {
            const spec = specifications.find(s => s.id === id);
            if (!spec) {
                showNotification('Especificación no encontrada', 'error');
                return;
            }
            
            editMode = true;
            
            // Llenar el formulario
            document.getElementById('specId').value = spec.id;
            document.getElementById('specName').value = spec.name;
            document.getElementById('specCategory').value = spec.category;
            document.getElementById('specDescription').value = spec.description || '';
            document.getElementById('specVersion').value = spec.version || '';
            document.getElementById('specStatus').value = spec.status || 'Activo';
            document.getElementById('specDate').value = spec.date || '';
            
            // Limpiar y llenar especificaciones técnicas
            const container = document.getElementById('techSpecsContainer');
            container.innerHTML = '';
            
            for (const [key, value] of Object.entries(spec.specs)) {
                addSpecField(key, value);
            }
            
            // Asegurar al menos un campo vacío adicional
            addSpecField();
            
            // Actualizar título del modal
            document.getElementById('addSpecModalLabel').textContent = 'Editar Especificación';
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('addSpecModal'));
            modal.show();
            
            showNotification(`Editando: ${spec.name}`, 'info');
        }
        
        function saveSpecification() {
            // Validar formulario
            const name = document.getElementById('specName').value.trim();
            const category = document.getElementById('specCategory').value;
            
            if (!name) {
                showNotification('El nombre del producto es obligatorio', 'warning');
                document.getElementById('specName').focus();
                return;
            }
            
            if (!category) {
                showNotification('Por favor seleccione una categoría', 'warning');
                document.getElementById('specCategory').focus();
                return;
            }
            
            // Recopilar especificaciones técnicas
            const specs = {};
            const specInputs = document.querySelectorAll('#techSpecsContainer .spec-field-group');
            let hasValidSpecs = false;
            
            specInputs.forEach(input => {
                const key = input.querySelector('.spec-key').value.trim();
                const value = input.querySelector('.spec-value').value.trim();
                
                if (key && value) {
                    specs[key] = value;
                    hasValidSpecs = true;
                }
            });
            
            if (!hasValidSpecs) {
                showNotification('Agregue al menos una especificación técnica válida', 'warning');
                return;
            }
            
            // Preparar datos
            const specData = {
                name: name,
                category: category,
                description: document.getElementById('specDescription').value.trim(),
                version: document.getElementById('specVersion').value.trim(),
                status: document.getElementById('specStatus').value,
                date: document.getElementById('specDate').value || new Date().toISOString().split('T')[0],
                specs: specs
            };
            
            if (editMode) {
                // Modo edición
                const id = parseInt(document.getElementById('specId').value);
                const index = specifications.findIndex(s => s.id === id);
                
                if (index !== -1) {
                    specifications[index] = {
                        ...specifications[index],
                        ...specData
                    };
                    
                    showNotification(`"${name}" actualizado correctamente`, 'success');
                }
            } else {
                // Modo agregar
                specData.id = nextId++;
                specifications.push(specData);
                
                showNotification(`"${name}" agregado correctamente`, 'success');
            }
            
            // Guardar y actualizar
            saveToLocalStorage();
            renderSpecifications();
            setupCategoryFilters(); // Actualizar filtros
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addSpecModal'));
            modal.hide();
        }
        
        function deleteSpecification(id) {
            const spec = specifications.find(s => s.id === id);
            if (!spec) return;
            
            if (!confirm(`¿Está seguro de eliminar "${spec.name}"?\nEsta acción no se puede deshacer.`)) {
                return;
            }
            
            const index = specifications.findIndex(s => s.id === id);
            if (index !== -1) {
                const deletedName = specifications[index].name;
                specifications.splice(index, 1);
                
                saveToLocalStorage();
                renderSpecifications();
                setupCategoryFilters();
                
                showNotification(`"${deletedName}" eliminado correctamente`, 'success');
            }
        }

        // ============================================
        // GESTIÓN DE CAMPOS DE ESPECIFICACIONES
        // ============================================
        
        function addSpecField(key = '', value = '') {
            const container = document.getElementById('techSpecsContainer');
            const fieldId = 'spec-field-' + Date.now();
            
            const div = document.createElement('div');
            div.className = 'spec-field-group input-group mb-2';
            div.id = fieldId;
            
            div.innerHTML = `
                <input type="text" class="form-control spec-key" placeholder="Característica" value="${escapeHtml(key)}">
                <span class="input-group-text">→</span>
                <input type="text" class="form-control spec-value" placeholder="Valor" value="${escapeHtml(value)}">
                <button type="button" class="btn btn-outline-danger remove-spec" title="Eliminar campo">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(div);
            
            // Agregar event listener al botón de eliminar
            const removeBtn = div.querySelector('.remove-spec');
            removeBtn.addEventListener('click', function() {
                // No eliminar si es el último campo y está vacío
                const totalFields = container.querySelectorAll('.spec-field-group').length;
                const isEmpty = !key && !value && 
                    !div.querySelector('.spec-key').value && 
                    !div.querySelector('.spec-value').value;
                
                if (totalFields > 1 || !isEmpty) {
                    div.remove();
                    showNotification('Campo eliminado', 'info');
                }
            });
            
            // Auto-focus en el primer campo vacío
            if (!key && !value) {
                setTimeout(() => div.querySelector('.spec-key').focus(), 100);
            }
        }
        
        function resetSpecFields() {
            const container = document.getElementById('techSpecsContainer');
            container.innerHTML = '';
            addSpecField(); // Campo inicial
            addSpecField(); // Campo adicional vacío
        }

        // ============================================
        // FUNCIONALIDADES ADICIONALES
        // ============================================
        
        function resetForm() {
            document.getElementById('specForm').reset();
            document.getElementById('specId').value = '';
            document.getElementById('specDate').value = new Date().toISOString().split('T')[0];
            resetSpecFields();
        }
        
        function refreshData() {
            renderSpecifications();
            showNotification('Datos actualizados', 'info');
        }
        
        function exportData() {
            if (specifications.length === 0) {
                showNotification('No hay datos para exportar', 'warning');
                return;
            }
            
            // Crear contenido CSV
            let csv = 'ID,Nombre,Categoría,Descripción,Versión,Estado,Fecha,Especificaciones\n';
            
            specifications.forEach(spec => {
                const specsStr = Object.entries(spec.specs)
                    .map(([k, v]) => `${k}: ${v}`)
                    .join('; ');
                
                csv += `"${spec.id}","${spec.name}","${spec.category}","${spec.description || ''}","${spec.version || ''}","${spec.status || ''}","${spec.date || ''}","${specsStr}"\n`;
            });
            
            // Crear y descargar archivo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `especificaciones_tegra_${new Date().toISOString().split('T')[0]}.csv`;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification(`Exportadas ${specifications.length} especificaciones`, 'success');
        }

        // ============================================
        // FUNCIONES DE UTILIDAD
        // ============================================
        
        function showNotification(message, type = 'info') {
            // Eliminar notificaciones previas
            document.querySelectorAll('.tegra-notification').forEach(el => {
                try {
                    const bsAlert = new bootstrap.Alert(el);
                    bsAlert.close();
                } catch (e) {
                    el.remove();
                }
            });
            
            const colors = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            };
            
            const icons = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            };
            
            const alert = document.createElement('div');
            alert.className = `alert ${colors[type] || 'alert-info'} tegra-notification alert-dismissible fade show`;
            alert.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="${icons[type] || 'fas fa-info-circle'} me-2 fs-5"></i>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                </div>
            `;
            
            document.body.appendChild(alert);
            
            // Auto-remover después de 5 segundos
            setTimeout(() => {
                if (alert.parentNode) {
                    try {
                        const bsAlert = new bootstrap.Alert(alert);
                        bsAlert.close();
                    } catch (e) {
                        alert.remove();
                    }
                }
            }, 5000);
        }
        
        function getStatusColor(status) {
            const statusMap = {
                'Activo': 'success',
                'En desarrollo': 'warning',
                'Beta': 'info',
                'Descontinuado': 'secondary'
            };
            return statusMap[status] || 'secondary';
        }
        
        function updateSpecCount(count = null, searchTerm = '') {
            const element = document.getElementById('specCount');
            
            if (count === null) {
                count = currentFilter === 'all' 
                    ? specifications.length 
                    : specifications.filter(s => s.category === currentFilter).length;
            }
            
            let text = '';
            if (searchTerm) {
                text = `${count} especificación${count !== 1 ? 'es' : ''} encontrada${count !== 1 ? 's' : ''} para "${searchTerm}"`;
            } else if (currentFilter === 'all') {
                text = `${count} especificación${count !== 1 ? 'es' : ''} en total`;
            } else {
                text = `${count} especificación${count !== 1 ? 'es' : ''} en "${currentFilter}"`;
            }
            
            element.textContent = text;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Sin fecha';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // INICIALIZACIÓN FINAL
        // ============================================
        
        // Verificar que Bootstrap esté cargado
        if (typeof bootstrap === 'undefined') {
            console.error('Bootstrap no está cargado correctamente');
            showNotification('Error: Bootstrap no está cargado', 'error');
        }
        
        // Para debugging
        console.log('Tegra Spec Manager v1.0.0 - Aplicación inicializada');
        console.log(`Especificaciones cargadas: ${specifications.length}`);
    </script>
</body>
</html>
