<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tegra - Technical Spec Manager</title>

  <!-- Favicon Links -->
  <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
  
  <!-- 1. ESTILOS PRIMERO -->
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- 2. LIBRERÍAS EXTERNAS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
  <!-- 3. MÓDULOS DE LA APLICACIÓN (ESENCIALES) -->
  <script src="state-manager.js"></script>
  <script src="error-handler.js"></script>
  <script src="pdf-generator.js"></script>
  
</head>
<body>
  <div class="app-container">
      <!-- ========================================================= -->
      <!-- HEADER -->
      <!-- ========================================================= -->
      <header class="app-header">
          <div class="logo-section">
              <div class="app-logo">
                  <!-- SVG Logo -->
              </div>
              <div>
                  <h1 class="app-title">Technical Spec Manager</h1>
                  <p class="app-subtitle">Sistema de gestión de especificaciones técnicas</p>
              </div>
              <div class="theme-toggle">
                  <button id="themeToggle" class="theme-toggle-btn">
                      <i class="fas fa-sun"></i> Modo Claro
                  </button>
              </div>
          </div>
          <div class="client-section">
              <span class="client-label">CUSTOMER / CLIENTE:</span>
              <div class="client-logo-wrapper">
                  <img id="logoCliente" alt="Logo del cliente" style="max-height: 35px; max-width: 120px; display: none;">
              </div>
          </div>
          <div class="header-actions">
              <div class="folder-input-container">
                  <span class="client-label" style="font-size: 0.9rem; color: White;"># FOLDER:</span>
                  <input type="text" id="folder-num" class="form-control" placeholder="#####">
              </div>
              <div id="current-datetime"></div>
          </div>
      </header>

      <!-- ========================================================= -->
      <!-- NAVIGATION -->
      <!-- ========================================================= -->
      <nav class="app-nav no-print">
          <ul class="nav-tabs">
              <li class="nav-tab active" data-tab="dashboard">
                  <i class="fas fa-tachometer-alt"></i> Dashboard
              </li>
              <li class="nav-tab" data-tab="spec-creator">
                  <i class="fas fa-file-alt"></i> Crear Spec
              </li>
              <li class="nav-tab" data-tab="saved-specs">
                  <i class="fas fa-database"></i> Guardadas
              </li>
              <li class="nav-tab" data-tab="error-log">
                  <i class="fas fa-exclamation-triangle"></i> Log de Errores
              </li>
          </ul>
      </nav>

      <!-- ========================================================= -->
      <!-- MAIN CONTENT (Ahora con las plantillas incrustadas) -->
      <!-- ========================================================= -->
      <main id="app-content" class="app-main">
        <!-- Contenido de Dashboard (Visible por defecto) -->
        <div id="dashboard-tab-content" class="tab-content">
          <div class="dashboard-grid">
              <div class="stat-card">
                  <div class="stat-number" id="total-specs">0</div>
                  <div class="stat-label">Specs Totales</div>
              </div>
              <div class="stat-card">
                  <div id="today-specs">
                      <div style="font-size:0.9rem; color:var(--text-secondary);">Última Spec:</div>
                      <div id="last-spec-name" style="font-size:1.2rem; font-weight:bold; color:var(--primary);">Ninguna</div>
                      <div id="last-spec-date" style="font-size:0.8rem; color:var(--text-secondary);">-</div>
                  </div>
                  <div class="stat-label">Última Creación</div>
              </div>
              <div class="stat-card">
                  <div class="stat-number" id="active-projects">0</div>
                  <div class="stat-label">Proyectos Activos</div>
              </div>
              <div class="stat-card">
                  <div id="completion-rate">
                      <div style="font-size:0.9rem; color:var(--text-secondary);">Placements totales:</div>
                      <div id="total-placements" style="font-size:1.5rem; font-weight:bold; color:var(--primary);">0</div>
                  </div>
                  <div class="stat-label">Placements Totales</div>
              </div>
          </div>
          <div class="card">
              <div class="card-header">
                  <h2 class="card-title"><i class="fas fa-rocket"></i> Acciones Rápidas</h2>
                  <div class="no-print">
                      <button class="btn btn-outline btn-sm" onclick="clearErrorLog()">
                          <i class="fas fa-trash"></i> Limpiar Log
                      </button>
                  </div>
              </div>
              <div class="card-body" style="text-align:center;">
                  <div style="margin-top:20px; display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">
                      <button class="btn btn-primary btn-lg" onclick="showTab('spec-creator')">
                          <i class="fas fa-plus"></i> Nueva Spec
                      </button>
                      <button class="btn btn-warning btn-lg" onclick="document.getElementById('excelFile').click()">
                          <i class="fas fa-folder-open"></i> Cargar Spec
                      </button>
                      <button class="btn btn-success btn-lg" onclick="document.getElementById('excelFile').click()">
                          <i class="fas fa-file-excel"></i> Cargar SWO
                      </button>
                      <button class="btn btn-outline btn-lg" onclick="loadSavedSpecsList(); showTab('saved-specs')">
                          <i class="fas fa-history"></i> Ver Historial
                      </button>
                      <button class="btn btn-danger btn-lg" onclick="showTab('error-log')">
                          <i class="fas fa-bug"></i> Ver Errores
                      </button>
                  </div>
              </div>
          </div>
        </div>

        <!-- Contenido del Creador de Specs (Oculto) -->
        <div id="spec-creator-tab-content" class="tab-content" style="display: none;">
          <form id="spec-creator-form">
              <div class="card">
                  <div class="card-header">
                      <h2 class="card-title"><i class="fas fa-file-invoice"></i> Datos Generales</h2>
                  </div>
                  <div class="card-body">
                      <div class="form-grid">
                          <div class="form-group">
                              <label for="customer" class="form-label">Customer / Cliente</label>
                              <input type="text" id="customer" class="form-control" list="customer-list">
                              <datalist id="customer-list">
                                  <option value="GEAR FOR SPORT">
                                  <option value="ADIDAS">
                                  <option value="NIKE">
                                  <option value="UNDER ARMOUR">
                                  <option value="HADDAD">
                                  <option value="FANATICS">
                              </datalist>
                          </div>
                          <div class="form-group">
                              <label for="style" class="form-label">Style</label>
                              <input type="text" id="style" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="season" class="form-label">Season</label>
                              <input type="text" id="season" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="colorway" class="form-label">Garment Color / Colorway</label>
                              <input type="text" id="colorway" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="po" class="form-label">P.O. #</label>
                              <input type="text" id="po" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="name-team" class="form-label">Name / Team</label>
                              <input type="text" id="name-team" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="program" class="form-label">Program</label>
                              <input type="text" id="program" class="form-control">
                          </div>
                          <div class="form-group">
                              <label for="spec-date" class="form-label">Spec Date</label>
                              <input type="date" id="spec-date" class="form-control">
                          </div>
                      </div>
                  </div>
              </div>
              <div class="card">
                  <div class="card-header">
                      <h2 class="card-title"><i class="fas fa-layer-group"></i> Placements</h2>
                      <div class="card-actions">
                          <button type="button" class="btn btn-primary"><i class="fas fa-plus"></i> Añadir Placement</button>
                      </div>
                  </div>
                  <div class="card-body">
                      <div id="placements-tabs" class="placements-tabs"></div>
                      <div id="placements-container"></div>
                  </div>
              </div>
              <div class="card">
                  <div class="card-header">
                      <h2 class="card-title"><i class="fas fa-cogs"></i> Acciones</h2>
                  </div>
                  <div class="card-body">
                      <div class="global-actions">
                          <button type="button" class="btn btn-success"><i class="fas fa-file-pdf"></i> Exportar a PDF</button>
                          <button type="button" class="btn btn-secondary"><i class="fas fa-file-excel"></i> Exportar a Excel</button>
                          <button type="button" class="btn btn-danger"><i class="fas fa-trash"></i> Limpiar Formulario</button>
                           <button type="button" class="btn btn-primary"><i class="fas fa-file-archive"></i> Descargar Proyecto (.zip)</button>
                      </div>
                  </div>
              </div>
          </form>
        </div>

        <!-- Contenido de Specs Guardadas (Oculto) -->
        <div id="saved-specs-tab-content" class="tab-content" style="display: none;">
          <div class="card">
              <div class="card-header">
                  <h2 class="card-title"><i class="fas fa-history"></i> Specs Guardadas Localmente</h2>
                  <div class="no-print">
                      <button class="btn btn-danger btn-sm" onclick="clearAllSpecs()">
                          <i class="fas fa-exclamation-triangle"></i> Limpiar Todo
                      </button>
                  </div>
              </div>
              <div class="card-body">
                  <div id="saved-specs-list">
                      <p style="text-align:center; color:var(--text-secondary); padding:20px;">
                          <i class="fas fa-database" style="font-size:2rem; margin-bottom:10px; display:block;"></i>
                          Cargando specs guardadas...
                      </p>
                  </div>
              </div>
          </div>
        </div>

        <!-- Contenido del Log de Errores (Oculto) -->
        <div id="error-log-tab-content" class="tab-content" style="display: none;">
          <div class="card">
              <div class="card-header">
                  <h2 class="card-title"><i class="fas fa-bug"></i> Registro de Errores</h2>
                  <div class="no-print">
                      <button class="btn btn-danger btn-sm" onclick="clearErrorLog()">
                          <i class="fas fa-trash"></i> Limpiar Log
                      </button>
                  </div>
              </div>
              <div class="card-body">
                  <div id="error-log-content" style="max-height: 500px; overflow-y: auto; font-family: 'Courier New', Courier, monospace; background-color: var(--bg-darker); padding: 15px; border-radius: var(--radius);"> 
                      <p>Cargando registro de errores...</p>
                  </div>
              </div>
          </div>
        </div>
      </main>

      <div class="logos-container">
          <!-- SVG Logo -->
      </div>

      <div id="statusMessage" class="status-message"></div>
  </div>

  <!-- Inputs ocultos -->
  <input type="file" id="excelFile" accept=".xlsx, .xls, .json, .zip" style="display: none;">
  <input type="file" id="imageInput" accept="image/*" style="display: none;">
  <input type="file" id="placementImageInput" accept="image/*" style="display: none;">

  <!-- 4. SCRIPTS DE LA APLICACIÓN (EL ORDEN ES IMPORTANTE) -->
  <!-- Primero, el cargador de configuración -->
  <script src="config-loader.js"></script>
  <!-- Luego, el script principal de la aplicación que depende de la config y los módulos -->
  <script src="app.js"></script>

</body>
</html>
