<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tegra - Technical Spec Manager</title>
    
    <!-- 1. ESTILOS PRIMERO -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- 2. LIBRERÍAS EXTERNAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>
    
    <!-- 3. NUESTROS MÓDULOS - ORDEN CRÍTICO (usar defer para respetar orden) -->
    <!-- PRIMERO: Configuración principal -->
    <script src="config.js" defer></script>

    <!-- Configs y utilidades complementarias -->
    <script src="config-teams-unified.js" defer></script>
    <script src="state-manager.js" defer></script>
    <script src="validators.js" defer></script>
    <script src="error-handler.js" defer></script>
    <script src="specialties-detector.js" defer></script>
    <script src="render-helpers.js" defer></script>
    <script src="fixes.js" defer></script>

    <!-- Último: la lógica principal de la app -->
    <script src="app.js" defer></script>
</head>
<body>
    <div class="app-container">
        <!-- ========================================================= -->
        <!-- HEADER -->
        <!-- ========================================================= -->
        <header class="app-header">
            <div class="logo-section">
                <div class="app-logo">
                    <!-- SVG del logo (abreviado en el repositorio) -->
                    <svg viewBox="0 0 145.94 39.05" xmlns="http://www.w3.org/2000/svg">
                        <!-- contenido SVG -->
                    </svg>
                </div>
                <div>
                    <h1 class="app-title">Technical Spec Manager</h1>
                    <p class="app-subtitle">Sistema de gestión de especificaciones técnicas</p>
                </div>
                <div class="theme-toggle">
                    <button id="themeToggle" class="theme-toggle-btn">
                        <i class="fas fa-sun"></i> Modo Claro
                    </button>
                </div>
            </div>

            <div class="client-section">
                <span class="client-label">CUSTOMER / CLIENTE:</span>
                <div class="client-logo-wrapper">
                    <img id="logoCliente" alt="Logo del cliente" style="max-height: 35px; max-width: 120px; display: none;">
                </div>
            </div>

            <div class="header-actions">
                <div class="folder-input-container">
                    <span class="client-label" style="font-size: 0.9rem; color: White;"># FOLDER:</span>
                    <input type="text" id="folder-num" class="form-control" placeholder="#####">
                </div>
                <div id="current-datetime"></div>
            </div>
        </header>

        <!-- ========================================================= -->
        <!-- NAVIGATION -->
        <!-- ========================================================= -->
        <nav class="app-nav no-print">
            <ul class="nav-tabs">
                <li class="nav-tab active" onclick="showTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </li>
                <li class="nav-tab" onclick="showTab('spec-creator')">
                    <i class="fas fa-file-alt"></i> Crear Spec
                </li>
                <li class="nav-tab" onclick="showTab('saved-specs')">
                    <i class="fas fa-database"></i> Guardadas
                </li>
                <li class="nav-tab" onclick="showTab('error-log')">
                    <i class="fas fa-exclamation-triangle"></i> Log de Errores
                </li>
            </ul>
        </nav>

        <!-- ========================================================= -->
        <!-- MAIN CONTENT -->
        <!-- ========================================================= -->
        <main class="app-main">

            <!-- TAB: DASHBOARD -->
            <div id="dashboard" class="tab-content active">
                <!-- ... contenido del dashboard (igual que en tu HTML original) ... -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-specs">0</div>
                        <div class="stat-label">Specs Totales</div>
                    </div>
                    <div class="stat-card">
                        <div id="today-specs">
                            <div style="font-size:0.9rem; color:var(--text-secondary);">Última Spec:</div>
                            <div style="font-size:1.2rem; font-weight:bold; color:var(--primary);">Ninguna</div>
                            <div style="font-size:0.8rem; color:var(--text-secondary);">-</div>
                        </div>
                        <div class="stat-label">Última Creación</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="active-projects">0</div>
                        <div class="stat-label">Proyectos Activos</div>
                    </div>
                    <div class="stat-card">
                        <div id="completion-rate">
                            <div style="font-size:0.9rem; color:var(--text-secondary);">Placements totales:</div>
                            <div style="font-size:1.5rem; font-weight:bold; color:var(--primary);">0</div>
                        </div>
                        <div class="stat-label">Placements Totales</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-rocket"></i> Acciones Rápidas</h2>
                        <div class="no-print">
                            <button class="btn btn-outline btn-sm" onclick="clearErrorLog()">
                                <i class="fas fa-trash"></i> Limpiar Log
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="text-align:center;">
                        <div style="margin-top:20px; display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">
                            <button class="btn btn-primary btn-lg" onclick="showTab('spec-creator')">
                                <i class="fas fa-plus"></i> Nueva Spec
                            </button>
                            <button class="btn btn-warning btn-lg" onclick="document.getElementById('excelFile').click()">
                                <i class="fas fa-folder-open"></i> Cargar Spec
                            </button>
                            <button class="btn btn-success btn-lg" onclick="document.getElementById('excelFile').click()">
                                <i class="fas fa-file-excel"></i> Cargar SWO
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="loadSavedSpecsList(); showTab('saved-specs')">
                                <i class="fas fa-history"></i> Ver Historial
                            </button>
                            <button class="btn btn-danger btn-lg" onclick="showTab('error-log')">
                                <i class="fas fa-bug"></i> Ver Errores
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: SPEC CREATOR -->
            <div id="spec-creator" class="tab-content">
                <!-- INFORMACIÓN GENERAL -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-info-circle"></i> Información General</h2>
                        <div class="no-print">
                            <button class="btn btn-warning btn-sm" onclick="document.getElementById('excelFile').click()">
                                <i class="fas fa-folder-open"></i> Cargar SWO
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="clearForm()" style="margin-left: 10px;">
                                <i class="fas fa-broom"></i> Limpiar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">CLIENTE:</label>
                                <input type="text" id="customer" class="form-control" oninput="updateClientLogo()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">STYLE:</label>
                                <input type="text" id="style" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">COLORWAY:</label>
                                <input type="text" id="colorway" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">SEASON:</label>
                                <input type="text" id="season" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PATTERN #:</label>
                                <input type="text" id="pattern" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">P.O. #:</label>
                                <input type="text" id="po" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">SAMPLE TYPE:</label>
                                <input type="text" id="sample-type" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">NAME / TEAM:</label>
                                <input type="text" id="name-team" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">GENDER:</label>
                                <input type="text" id="gender" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">DISEÑADOR:</label>
                                <select id="designer" class="form-control">
                                    <option value="">Seleccionar...</option>
                                    <option value="ELMER VELEZ">ELMER VELEZ</option>
                                    <option value="DANIEL HERNANDEZ">DANIEL HERNANDEZ</option>
                                    <option value="CINDY PINEDA">CINDY PINEDA</option>
                                    <option value="FERNANDO FERRERA">FERNANDO FERRERA</option>
                                    <option value="NILDA CORDOBA">NILDA CORDOBA</option>
                                    <option value="OTRO">OTRO</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SISTEMA DE MÚLTIPLES PLACEMENTS -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-layer-group"></i> Ubicaciones (Placements)</h2>
                        <div class="no-print">
                            <button class="btn btn-primary btn-sm" onclick="addNewPlacement()">
                                <i class="fas fa-plus"></i> Agregar Placement
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Contenedor de tabs para placements -->
                        <div id="placements-tabs" class="placement-tabs">
                            <!-- Tabs se generarán dinámicamente -->
                        </div>
                        
                        <!-- Contenedor principal de placements -->
                        <div id="placements-container">
                            <!-- Cada placement será una sección dentro de este contenedor -->
                        </div>
                    </div>
                </div>

                <!-- BOTONES DE ACCIÓN -->
                <div class="card no-print">
                    <div class="card-body" style="display:flex; gap:15px; flex-wrap:wrap; justify-content:center;">
                        <button class="btn btn-primary btn-lg" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Descargar Spec
                        </button>
                        <button class="btn btn-success btn-lg" onclick="exportPDF()">
                            <i class="fas fa-file-pdf"></i> Exportar PDF
                        </button>
                        <button class="btn btn-warning btn-lg" onclick="downloadProjectZip()">
                            <i class="fas fa-file-archive"></i> Descargar ZIP
                        </button>
                        <button class="btn btn-primary btn-lg" onclick="saveCurrentSpec()">
                            <i class="fas fa-save"></i> Guardar Spec
                        </button>
                        <button class="btn btn-outline btn-lg" onclick="clearForm()">
                            <i class="fas fa-broom"></i> Limpiar
                        </button>
                    </div>
                </div>
            </div>

            <!-- TAB: SPECS GUARDADAS -->
            <div id="saved-specs" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-database"></i> Specs Guardadas (Browser)</h2>
                        <button class="btn btn-outline btn-sm" onclick="clearAllSpecs()">
                            <i class="fas fa-trash"></i> Limpiar Todo
                        </button>
                    </div>
                    <div class="card-body" id="saved-specs-list">
                        <p style="text-align:center; color:var(--text-secondary); padding:20px;">
                            <i class="fas fa-database" style="font-size:2rem; margin-bottom:10px; display:block;"></i>
                            No hay specs guardadas. Crea una nueva spec para verla aquí.
                        </p>
                    </div>
                </div>
            </div>

            <!-- TAB: LOG DE ERRORES -->
            <div id="error-log" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> Log de Errores</h2>
                        <div class="no-print">
                            <button class="btn btn-outline btn-sm" onclick="clearErrorLog()">
                                <i class="fas fa-trash"></i> Limpiar Log
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="exportErrorLog()" style="margin-left: 10px;">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="error-log-content">
                            <!-- Los errores se cargarán aquí dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="logos-container">
            <!-- Logo adicional -->
        </div>

        <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- Inputs ocultos -->
    <input type="file" id="excelFile" accept=".xlsx, .xls, .json, .zip" style="display: none;">
    <input type="file" id="imageInput" accept="image/*" style="display: none;">
    <input type="file" id="placementImageInput" accept="image/*" style="display: none;">
</body>
</html>
